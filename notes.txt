buffy.c PATH_MAX (4096) vs _POSIX_PATH_MAX (256)
pager.c status_width = 0; /* comment */
many // → /* ... */
compose.c bad maths: (idxmax += 5 + numfiles) in expr!
init.c strings "yes", "no", "ask-yes", "ask-no" -- define centrally

Whitespace
	trailing
	tabs
		leading
		embedded
		comments
	align = (
leading
	8 spaces : ~5000 lines
	tab : ~15000 lines

Brackets space(space
Bang space!spaceVAR
Brace: kernel cuddle?  always around if/else etc
#if 0 > 16 y.o.
comments // → /* ... */
	gentoo
	fix block comments too
case brace  {} check scopes
static functions -- all declared?
mutt error gnu printf checks (all ...)
if's bracket anything more complex that ARG or !ARG
	maths too
#if vs #ifdef VAR
TRUE/FALSE? 52 times 1/0
grammar: its dont cant, spelling
line lengths
	14K empty
	94K <= 80 chars
	5K > 80 chars

sidebar requirements
	tidy code
	conditional compilation
	robust
	document
		functions
		config
	minimise changes to original code
	do I *require* fmemopen?
		should that be a separate patch?

valgrind
	memory leaks
	dodginess
sprintf checks
vet check_sec.sh
XXX: 32
FIXME: 29

────────────────────────────────────────────────────────────────────────────────

ellipsis
	mutt_error
	mutt_message
	mutt_debug

FMT_LEFT, etc 2007
#defines → enums?
make AUTHORS -- which repo did this?

Main sidebar repos
	Ismail
	Debian
	Gentoo 24r1
	Suse 24 2014/14/12 + sidebar colour
	Kzak
	Terry

Ultrix dead '95
	ask debian devs for list of working arches

draw_sidebar, calcboundaries don't use their args
BUFFY_SIZE no longer used (9 years)
#ifdef BUFFY_SIZE → if (option (OPTCHECKMBOXSIZE))
retval variable
	rc: 724
	rv: 132
strfcpy multiple defs
	dotlock.c
	lib.h
	rfc8222.c
init all vars
lots of static fns → _fn_name?
^L in source
Doxygen comments
TRUE/FALSE → BOOL
	return [01]; 752 occurrences
Vim-style
	:set     → show all modified vars
	:set all → all all vars
	:unset === set novar
strict compilation flags; c++ compiler?
unnamed args in function prototypes
spurious \ line endings (in middle of if!)

────────────────────────────────────────────────────────────────────────────────

Mutt panel manager

start with whole window (80x24)
Carve off blocks in sequence
Carve up by rows/cols or %age
All moves/prints now use opaque handles to the panel
Moves/prints strictly limited to panel
functions on panel
	get_rect
	clear_to_bol
	clear_to_eol
	clear_to_top
	clear_to_bottom
	clear_panel
Panels could wrap/nowrap
	handle left/right scrolling
	could be view_panes -- all data passed
		the panel controls paging
			too slow?
	needs to be paged by the panel user
controls to move between panels
	invisible cursor -- so left, right returns to where you were, etc
	mnemonics too?
	show focus with
		terminal's cursor?
		colour?

Example carving set:
	Block	Size	Name		X	Y	W	H	Notes
	top	1 line	Menu		0	0	80	1
	top	1 line	Help		0	1	80	1
	bottom	1 line	Entry		0	23	80	1
	bottom	1 line	Status		0	22	80	1
	left	20 cols	Sidebar		0	2	20	20	on by default
	right	0 cols	Reply		80	2	0	20	off by default
	top	10 line	Pager		20	2	60	10	currently on
	rest	-	Message		20	12	60	20	currently on

Hide pager →
	signal pager (hidden)
	signal message (resize, rect)

Hide sidebar →
	signal sidebar (hidden)
	signal pager (resize, rect)
	signal message (resize, rect)

Close message →
	signal message (hidden)
	signal pager (resize, rect)

Carve param: can receive focus
Where does the help page fit in?
	which panels does it hide?

────────────────────────────────────────────────────────────────────────────────

Notifications

Window changes
	hidden	no params
	visible	rect
	resize	rect
	focus	in/out
colours changes
keypress	key, no params
config change	key, value
		ALL, no params
mail status change
	read/unread/flagged/deleted/edited
	MESSAGE_ID, flags
mailbox change
	new/deleted
	new mail, deleted mail, flagged mail, etc
connection status
	connected
	disconnected
quitting - any use to anyone?
selected mail changed
selected mailbox changed

Panel manager - where does the horizontal divider fit in?
	status bar between pager and message
Panels can have vertical and/or horizontal scrollbars
	1 line/col  ├────▒▒▒▒▒▒────────────┤
	turn sidebar divider into a scrollbar
	separate colours for line/bar,arrows
	▲
	│
	▒
	│
	▼

wrapping →
	extra char at beginning of line "+"
	extra char at end of line "<-/"
wrap at:
	char
	word (whitespace)
	clause (punctuation)
	sentence (.!?)
No wrap →
	extra char at end of line ">"
carving
	enum: Top, Bottom, Left, Right, Rest
	number
	enum: rows/cols/percentage
	flags: visible, focus, wrap mode, scollbars
focus & panels should determine a key's action
	current panel gets notification
	if recjected (or uncaught) try other panels
	try panels in what order?
panels keep in internal cursor, so user can write many long (wrapped) lines
	and not worry.  The panel will display (optional) wrap chars
	or _not_ wrap, etc.  Eventually the user's write will soft-fail
	→ write beyond panel's size

────────────────────────────────────────────────────────────────────────────────

send escape sequence to clear terminal title when mutt closes
init.h struct option_t needs enums for types and union for data
timer notifications, e.g.
	highlight something for three seconds, then return to normal
https://github.com/N8Fear/mutt-kz
	some initialisations improvements
	some bug fixes

set patch commit dates to patch-date
set commit dates to author dates
toggle-sidebar command

widestring folder names
	highlight broken (wrong width)
	are truncated because 3 bytes is only 2 spaces
	wcwidth() / wcswidth()
<stdbool.h> in sidebar.c
sidebar_delim
	change name to sidebar_dividers
	first (wide) character is vertical divider
		between sidebar and index/pager
	second (wide) character is horizontal divider
		between different mailboxes (within the sidebar)
sidebar_color
	background color for entire sidebar region?

need attention
	draw_sidebar
	OPTSIDEBARSORT
		sorts by real path, not visible name

check for unused #include
sort includes <>, ""

sort init.h, globals.h, etc

kill one-line if's:
	if (adsfa) command;

make_sidebar_entry leaks as string is passed to printw

~50 lines of commented out source
	/* ... ; */

possible to fix sidebar sort order to respect hierarchy/indentation?

for LONG list of mailboxes, need vim-style scroll-offset param to control paging

gentoo sidebar_format
	set sidebar_format="%B %* %S%?N?(%N)?%?F?[%F]?"

RICH
	123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
	inbox                                 0│
	tree                                  0│
	    birchbirchbirchbirch       10(7)[1]│
	    义勇军义勇军义勇军             4(1)│


GENTOO
	123456789012345678901234567890123456789012345678901234567890123456789012345678901234567890
	inbox                               0│
	tree                                0│
	    birchbirchbirchbirch     10(7)[1]│
	    义勇军义勇军义勇军                    4(1)

// What about if screen is narrower than SidebarWidth?
    COLS = width;
should be
    COLS = min (COLS, width);

compile with clang for more warnings

sidebar_width = auto (size to contents)

sidebar highlight doesn't cover lines consistently
	covers text only in "%B"
	covers line total in "%B%* "
	highlights empty indent spaces

fix? whitelist to use +dir notation?
	relative to $folder
	what about multiple folders?

sidebar width : fixed string breaks bounds
	set sidebar_width=10
	set sidebar_format="ABCDEFGHIJKLMNOPQRSTUVWXYZ"

:quit / :q command for vi users

sidebar_width defaults to 0!

cleanup:
	docs - in code and html
	comments
	whitespace
		unfold lines
		indent
		rebracket
		refold
	sort options in
		init.h
		globals.h
		functions.h
		switches

when a two-cell character is truncated by 1 it needs to be space padded to maintain alignment

check all string config vars are NONULL'd

sorting
	if displaying full paths:
		sort by display name
		sort by underlying name
	if displaying indented paths:
		sort by top-level names, then children

New only -- include structure (empty dirs) to keep hierarchy
	mail (0)
	  fruit (0)
	    apple (1)

what causes sidebar to page down after a few entries?
	someone manipulating TopBuffy

if ((!visible) || (size == 0))
	make sure no work is done

commands for show/hide sidebar
	need command to toggle view

group sidebar build stuff in makefiles, etc, cf kzak

trim trailing slash from mailboxes, folder
	shouldn't be displayed

on Terry's update notify authors & list & kz

check all headers #include requisites for compilation

FOREVER, rather than while(1)

check ALL pointers

sb_set_curbuffy's while loop should look like sb_set_buffystats's

sb_set_curbuffy
sb_set_buffystats
	should probably both return BOOL on success/failure

sb_set_update_time should return the timestamp

sb_draw should return success of drawing
	possible given all the callbacks, etc?

quiet config option -- don't whine about unknown config options

sensible retvals on functions

command
	sidebar_toggle_visible
	sidebar_toggle → sidebar_toggle_virtual

────────────────────────────────────────────────────────────────────────────────
missing patches
	colour divider
	sort
	lightweight
	fmemopen

rename BUFFY->msgcount → BUFFY->msg_count

DBUS plugin -- to do what?
	notify out
	take input to do what?

────────────────────────────────────────────────────────────────────────────────

print redraw counter in each window

repaint if:
	size changes
	position changes

Box needs old-computed Rect
if different, notify

Box needs Notify callback
Flags: changed posn, changed size

Changed posn notification ONLY
	e.g. sidebar has swapped sides
could imply that cached data may be OK to reuse
	e.g. don't need to call calc_boundaries

Notify (Box*, Rect old, Rect new, flags)
Flags:
	too small to render
	changed visibility

Show toggle-key in each window
	i - index
	p - pager
	h - help line
	? - help page
	s - status
	b - sidebar
	x - sidebar swap sides

option
	sidebar-show-page-number
	sidebar-page-number
	e.g. Right aligned:
		Page 3 of 6
		(3/6)

Changelog, etc for sidebar

────────────────────────────────────────────────────────────────────────────────

Sidebar actions (that might precipitate change):
	line-up
	line-down
	page-up
	page-down
	set buffy from browser
	change sort order
	add mailbox
	delete mailbox
	change mailbox's sort criteria (e.g. flag an email, a flagged-sorted mailbox)
	resize window
	hide sidebar
	show sidebar
	open folder

Sidebar distinguish between a FOCUSSED sidebar entry and the OPEN sidebar entry
	Need a sidebar cursor (e.g. bg = grey)
	Sidebar selected (open), (e.g. bg = blue, or '*' suffix, or bold)
	May need HighlightedBuffy variable
		Paging of sidebar follows this HighlightedBuffy

────────────────────────────────────────────────────────────────────────────────

Tidying actions

Conditional build
	Makefile
	configure.ac
	OPS.SIDEBAR
	#ifdef USE_SIDEBAR

Comments on
	functions
	block
	removal of junk comments
	init.h functions

Indent
	our source files
	our functions in mutt source files
	our code lines in mutt functions

Indent
	tabs
	brackets whitespace
	brackets around complex logic
	braces, functions, if/while/etc, struct/enum/etc
	function definitions
		name parameters
	align =
	pointers X *x, !x
	trailing whitespace

Functions
	name consistently
	reorder, static the public
	name params sensibly

Unused
	remove structs
	remove params
	remove functions
	#if 0
	#include

Checks
	Init vars
	check pointers/all params
	retvals BOOL, compare with if (!fn())
	if ((x = y()) == NULL)
	logic if (x + y > 6)
	maths spacing _+_
	reserved words: new, this, etc

────────────────────────────────────────────────────────────────────────────────

draw sidebar
	assumes position/size
	move due to STATUSONTOP, HELP
	check of show/hidden has changed & refresh numbers if nec
	if hidden, do nothing
	sanity check settings
	draw divider (3 chars!)
for all buffers
	set colour
	move
	gen displayname (need to cache this)
		name, bytelen, screenlen
		what about config changes
			including sort order
	make sidebar_entry
fill remaining lines with blanks

Start; Incoming; Inbox open; current = Incoming; sort → cur is offscreen, boundaries lost

────────────────────────────────────────────────────────────────────────────────

Emails

Tidy
	clean code
	18 month dev cycle
		not even development
		just a bug fix cycle
	never a good time
	very conservative development
		(quite) understandably
	object oriented
	when? 4 releases in 5 years

	1.5.19 7 years ago
	1.5.20 6 years ago
	1.5.21 5 years ago
	1.5.22 2 years, 3 months ago
	1.5.23 1 year, 8 months ago
	1.5.24 3 months ago

New dev
	Imagine...

	New developer comes along
	Enthusiasm
	Free time
	Ideas

Patches / Branches / Community

	2nd class citizens
	branches against latest release
	draw in & encourage devs

	sidebar interested
		maintained for 10 years
		fix it
		integrate changes
	
	notmuch overlays sidebar

	nntp

	last patch integrated again 1.5.15 (9 years ago)

	downstream patches

	branch against dev if they wish

────────────────────────────────────────────────────────────────────────────────

Panel manager
	┌────────────────────────┐    ┌────────────────────────┐ 
	├──────┬─────────────────┤    ├──────┬─────────────────┤ 
	│side  │index            │    │side  │help             │ 
	│      │                 │    │      │                 │ 
	│      ├─────────────────┤    │      │                 │ 
	│      │pager            │    │      │                 │ 
	│      │                 │    │      │                 │ 
	│      │                 │    │      │                 │ 
	├──────┴─────────────────┤    ├──────┴─────────────────┤ 
	└────────────────────────┘    └────────────────────────┘ 

min/max dimensions
min not achieved ⇒ error
ask what's available
max specified ⇒ limit
max = ∞ ⇒ fill screen

Objects
		MinWid	MaxWid	MinHt	MaxHt	Visible	Resize	AutoResize
Helpline	1	∞	1	1	opt	no	-
Sidebar		1	∞	1	∞	opt	yes	no
Index		1	∞	1	10	opt	yes	no
Pager		1	∞	1	∞	opt	yes	yes
Helppage	1	∞	1	∞	opt	yes	yes
Status		1	∞	1	1	yes	no	-

Panels
Top (invis, fill space)
	Helpline
	Middle (invis, fill space)
		Sidebar
		Right (invis, fill space)
			Index
			Pager
			Help
	StatusLine

Scan children first looking for expanders?
	multiple expanders ⇒ log; reduce laters ones to min size, or 1
	single-run loop backwards
		too messy, too hard
	single - first pass, calculate size of fixed elements
		when on expander, lie about Rect dimensions

────────────────────────────────────────────────────────────────────────────────

Pages

 I p1           p2            p3            p4
 ┌─────────────┬─────────────┬─────────────┬───────┐
 │abcdefghijklm│nopqrstuvwxyz│ABCDEFGHIJKLM│NOPQRST│
 └─────────────┴─────────────┴─────────────┴───────┘
               Top    ^      Bot
                      Cur

────────────────────────────────────────────────────────────────────────────────

Mouse
	BUTTON_PRESSED or BUTTON_CLICKED

	Allow events to be captured by the user
		<index-click>, <sidebar-double-click>, etc
	Add "buttons"
		close button, top right [X]

Sidebar
	click		select & open
	scroll up	scroll list up   1 line (no highlight)
	scroll down	scroll list down 1 line (no highlight)
	double-click	hide sidebar

Sidebar divider
	click-drag	move divider

Sidebar scrollbar
	click		page up/down
	2-click		move to here

Index
	click		select & open
	scroll up	scroll list up   1 line (no highlight)
	scroll down	scroll list down 1 line (no highlight)

Index divider
	click-drag	move divider

Pager
	scroll up	scroll page up   1 line
	scroll down	scroll page down 1 line
	double-click	close pager

Help
	click		show menu

Status bar
	click		???	

────────────────────────────────────────────────────────────────────────────────

History
	:set sidebar<UP>
	should match only 'set sidebar.*'

